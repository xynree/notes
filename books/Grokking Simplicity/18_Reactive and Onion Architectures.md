# 18 - Reactive and Onion Architectures

## Two separate architectural patterns

![picture 1](https://s2.loli.net/2022/09/10/JB64AlxEbQnoN17.png)  

- Reactive Architecture
  - Flips the way we express the ordeer of actions in our code
  - Decouples cause from effect
- Onion Architecture
  - Gives structure to services that must interact with the outside world
  - Naturally arrises in functional thinking

## Coupling of causes and effects of changes

## What is reactive architecture?

- Main organizing principle = specify what happens in response to events (event handlers)

![picture 2](https://s2.loli.net/2022/09/10/q9rweYgUiXTFc56.png)  

- Everything happens in response to something else. When X happens, do Y. When Y happens, do Z. Break up step-by-step handler functions into a series of handlers that respond to the previous one

## Tradeoffs of the reactive architecture

- Instead of Do X then Y, reactive style = Do Y whenever X happens
- Decouples effects from causes
  - Separating causes from effects can make code less readable
- Treats a series of steps as pipelines: Actions+ Calculations together
- Creates flexibility in your timeline

## Cells are first class state

- Turn state into an object to control its operations

![picture 4](https://s2.loli.net/2022/09/10/JYV3LqpKufU71M9.png)  

## Make cells reactive

- When state changes do X
- Add concept of `watchers` - handler functions that get called whenever state changes

## We can update icons when the cell changes

- Watchers run whenever current value changes - then add a function to that to update icons whenever fvalue changes
- Handler function does less (moved into watcher)
- Remove this extra call from all handlers

## `FormulaCells` calculate derived values

- Watch another cell and recalculate value when upstream cell changes

## Mutable state in functional programming

- All software takes in info from changing world and remembers part of it
- What's important is safety of state we use

## How reactive architecture reconfigures systems

3 major effects on code:

- Decouples effects from causes
- Treats series of steps as pipelines
- Creates flexibility

## Decouples effects from causes

- Your values may change for different reasons. If any change to the value needs to run essentially same code, we can decouple cause from affect
  - Anytime cart changes, regardless of cause, update the icons

## Decoupling manages a center of cause and effect

- Ways to change values vs Actions to do when value changes
- High growth of multiplying these two values is solved by decoupling
- Converts multiplication to addition
- Lets you think in terms of DOM updates
- When problem isn't high growth, decoupling might make things more confusing

## Trerat series of steps as pipelines

- Build complex actions out of simpler actions and calculations
- Composed actions = data enters in topa nd flows from one step to next
- When data generated by one step = input to next step, pipeline may be exactly what you need
- If steps don't follow pattern of passing data along, restructure or consider not using this pattern

## Flexibility in timeline

- Naturally splits timeline into smaller parts
  
  ![picture 5](https://s2.loli.net/2022/09/10/oJ62wnavt8lh1PH.png)  

- Split them in a way to eliminate shared resources

## Onion Architecture

- Occurs at a larger scale - construct entire services to interact with outside world
- OFten see reactive architecture nested instide onion architecture
![picture 6](https://s2.loli.net/2022/09/10/iGHmlfSaPzjKZ56.png)  

- Give sstructure to sercies that interact with outside world
- Architecture has concentric layers
- Interaction with world = interaction layer
- Layers call in torwards the center
- Layers don't know about lyaers outside of themselves

## Faciliatating Change and reuse

- Onion architecture lets you change interaction layer easily
- Since domain layer knows nothing about databases or requests, change it or use different service protocol
- External sercies (databases, aPI calls) are easiest to change in this architecture
- In onion = web server, handler, and database are all in interaction layer

## Examine terms used to place the rule in a lyaer

- Terms of domain = product, image, price, discount (business rules)
- Logic for connections = interaction layer

## Analyze readability and awkwardness

- Try to build your domain out of calculations and separate interaction layer from domain layer

## Summary

- Reactive architecture flips the way we sequence actions
- Reactive arch - organizes actions/calcs to pipelines
  - Pipelines = simple actionst hat happen in sequence
- First class mutable state lets us control the read and write operations
- Onion architecture devides software into 3 layers: itneraction, domain, language
- Interaction layer = actions of software. /Calls theh domain layer
- Domain layer = domain logic and business rules (calculations)
- Language layer = language plus util libraries
- Onion architecture = fractal. Found at every level of abstraction in actions
